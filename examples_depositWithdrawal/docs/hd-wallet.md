# Hierarchical Deterministic Wallet (HD Wallet)

HD Wallet은 블록체인 지갑의 표준으로, 하나의 시드(seed)로부터 여러 키를 생성할 수 있는 구조를 제공

---

## 1. HD Wallet의 특징

### 1.1 계층적 구조
- 계층적으로 키를 생성하여 관리가 용이
- 부모 키에서 파생된 하위 키(child key)를 통해 다양한 주소 생성 가능

### 1.2 단일 시드(seed) 복구
- 하나의 시드 문구(seed phrase)만으로 전체 지갑을 복구할 수 있음
- 예: "correct horse battery staple"와 같은 12단어 문구

---

## 2. HD Wallet의 구성 요소

### 2.1 마스터 키 (Master Key)
- 지갑의 루트 키로, 모든 하위 키의 부모 역할
- 개인 키와 공개 키를 포함

### 2.2 파생 키 (Derived Keys)
- 마스터 키에서 생성된 하위 키
- 고유한 지갑 주소를 생성

![wallet](../resource/deterministic-wallet.png)

---

## 3. HD Wallet 표준

### 3.1 BIP-32
- 계층적 키 생성의 기본 표준

### 3.2 BIP-44
- 여러 코인을 지원하기 위한 멀티코인 표준

---

## 4. HD 지갑의 생성 원리

- HD 지갑(Hierarchical Deterministic Wallet)은 **하나의 시드(seed)**에서 출발하여, 여러 키 쌍(개인키와 공개키) 및 여러 주소를 생성할 수 있는 시스템

- HD 지갑은 BIP-32 표준을 기반으로 설계되며, SHA256 해시 함수와 HMAC 같은 암호화 기술을 사용하여 계층적이고 결정론적으로 키를 생성

- HD 지갑으로 여러 키값을 만든다는 것 = 여러 주소를 생성한다는 의미
    - HD 지갑은 하나의 시드에서 파생된 개인키와 공개키 쌍을 생성하고, 공개키를 기반으로 새로운 주소를 만듬
    - 즉, 트랜잭션마다 새로운 개인키-공개키-주소를 자동으로 생성하여, 블록체인에서의 프라이버시를 향상시킴

### 4.1 시드란 무엇인가?
- **시드(seed)** 는 HD 지갑의 마스터 키를 생성하기 위한 랜덤 값
- 보통 12~24개의 **영단어 목록(니모닉 문구, mnemonic phrase)** 로 표현됨
    - 예: "apple banana cherry dog elephant..."

### 4.2 시드의 역할:

시드는 HD 지갑의 **모든 키 쌍(개인키와 공개키)** 을 결정론적으로 생성하는 데 사용됨
즉, 시드만 있으면 같은 HD 지갑을 정확히 복원 가능


### 4.3 시드는 여러 사람이 중복되는 값을 쓸 수 있나?

- 가능성은 있지만, 극도로 낮음
- 시드는 일반적으로 256비트의 랜덤 값으로 생성되며, 니모닉 문구를 통해 사람이 읽을 수 있는 단어로 변환될 뿐
    - 예: "apple banana cherry..." → 256비트 랜덤 값으로 변환
- 2^256의 경우의 수는 사실상 무한에 가까워서, 두 사람이 같은 시드를 사용할 확률은 거의 0에 가까움

    - 예: 시드를 'hl'로 지정한다면?
    
        일반적으로 사용자가 직접 시드를 정하지 않으며, 지갑이 안전한 랜덤 값을 생성

- 만약 두 사람이 같은 시드를 사용한다면, 이론적으로 동일한 키 쌍(개인키, 공개키)과 주소가 생성됨. 따라서 강력한 랜덤 시드를 사용하는 것이 중요

### 4.4 HD 지갑 복원의 원리
HD 지갑의 복원은 시드와 결정론적 키 생성 방식을 이용

- 지갑 복원의 과정
    1. 시드를 입력: 사용자는 백업된 시드 문구를 지갑 프로그램에 입력
    2. 마스터 키 생성: 입력된 시드에서 마스터 개인키와 마스터 공개키를 생성
    3. **키 경로(Path)** 를 따라 파생 키 생성: HD 지갑은 계층적 구조를 따라 개인키와 공개키 쌍을 생성
    - 예: **m/44'/0'/0'/0/0** 경로를 따라 키 생성
        - **44'**: BIP-44 표준
        - **0'**: 코인 타입(0 = 비트코인)
        - **0'/0/0**: 계좌 번호와 파생 키 번호
    - 이 경로를 따라가면, 지갑에 저장된 **모든 키 쌍(주소 포함)** 을 복원할 수 있음

### 4.5 왜 시드만 있으면 복원이 가능한가?
- 결정론적 키 생성 방식 덕분
    - 시드 → 마스터 개인키 → 마스터 공개키 → 파생 키 생성.
    - 이 과정은 항상 동일한 결과를 반환하므로, 같은 시드를 입력하면 정확히 동일한 지갑이 복원됨
- 백업된 시드만 있으면, 개별 개인키를 따로 보관하지 않아도 되는 이유:
    - HD 지갑은 시드를 기반으로 모든 키를 생성하기 때문에, 시드만 안전히 보관하면 다른 데이터는 필요 없음

### 4.6 HD 지갑의 구조 요약
- **시드(seed)**: 지갑 복원의 핵심. 지갑의 모든 키 쌍을 결정
- **마스터 키(master key)**: 시드에서 생성되는 최상위 키
- **파생 키(derived key)**: 마스터 키에서 파생된 개인키-공개키 쌍
- **주소(address)**: 파생 키의 공개키에서 해싱하여 생성

### 4.7 결론
- HD 지갑으로 여러 주소를 생성한다는 것은 여러 키 쌍을 만든다는 의미와 같음
- 시드는 HD 지갑의 "마스터 열쇠"로, 하나의 시드만으로 모든 키 쌍을 복원할 수 있음
- 시드는 강력한 랜덤 값으로 생성되며, 두 사람이 동일한 값을 가질 가능성은 극히 낮음
- 지갑 복원은 시드와 결정론적 키 생성 방식을 이용하므로, 백업된 시드만 있으면 지갑의 모든 데이터를 복원할 수 있음

---

## 5. 보안 고려사항

- **시드 문구 보관**: 시드 문구를 안전한 장소에 보관
- **키 관리**: 개인 키는 절대로 공유하지 말 것

---

## 6. 참고

- blogpost : [What is a Seed Phrase?](https://www.babypips.com/crypto/learn/what-is-a-seed-phrase)
- [learnmeabitcoin](https://learnmeabitcoin.com/beginners/guide/segwit/)