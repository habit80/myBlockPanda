# 비트코인 지갑 생성 가이드: 시드 문구에서 주소 생성까지

이 문서는 비트코인 지갑이 어떻게 생성되는지, 작동 원리는 무엇인지, 그리고 BIP-39, BIP-32, BIP-44, BIP-148과 같은 주요 표준이 지갑 기능 및 트랜잭션 효율성을 어떻게 지원하는지 단계별로 설명

---

## 1. 시드 문구에서 개인키 생성: 시작점

### 시드 문구란?
- **시드 문구(Mnemonic)** 는 12, 15, 18, 21, 또는 24개의 단어로 이루어진 문자열로, HD 지갑의 마스터 키를 생성하는 데 사용됨
- **BIP-39** 표준에 의해 정의
- 사람이 읽을 수 있는 단어로 구성되어 백업과 복구가 용이함

### 개인키는 어떻게 생성될까?
1. **시드 문구 → 엔트로피 변환**:
   - 시드 문구는 랜덤하게 생성된 128-256비트의 엔트로피 값을 나타냄
   - 각 단어는 BIP-39 단어 리스트를 통해 엔트로피의 일부에 매핑됨

2. **체크섬 추가**:
   - 데이터 무결성을 확인하기 위해 엔트로피에 체크섬을 추가

3. **PBKDF2 알고리즘**:
   - 엔트로피와 체크섬을 합쳐 PBKDF2 알고리즘(HMAC-SHA512)을 사용해 **마스터 시드**를 생성
   - 마스터 시드는 개인키 생성을 위한 입력값으로 사용

### 왜 안전할까?
- 128-256비트의 엔트로피로 인해 동일한 개인키가 생성될 확률은 극히 낮음
- 같은 시드 문구를 사용하더라도, 추가적인 패스프레이즈를 설정하면 서로 다른 지갑이 생성됨

---

## 2. 개인키에서 공개키 생성

### 공개키는 어떻게 생성될까?
1. **타원곡선 암호화(ECC)**:
   - 개인키는 secp256k1 타원곡선 방정식을 사용해 공개키를 계산
   - 동일한 개인키는 항상 동일한 공개키를 생성

2. **공개키 압축**:
   - 비트코인은 공개키를 65바이트에서 33바이트로 압축해 저장 공간을 절약

---

## 3. 공개키에서 비트코인 주소 생성

### 주소 생성 과정(해싱 과정)
- 비트코인 주소는 공개키를 해싱하여 생성됩니다:
  1. **SHA-256**: 공개키를 SHA-256 알고리즘으로 해싱.
  2. **RIPEMD-160**: 결과를 RIPEMD-160 알고리즘으로 다시 해싱.
  3. **Base58Check 인코딩**: 체크섬을 추가해 Base58 형식으로 인코딩하여 주소 생성.

### 주소 형식
- **Legacy (P2PKH)**:
  - 주소가 `1`로 시작 (예: `1A1zP1...`).
  - 수수료가 높고 비효율적.

- **SegWit (P2SH-P2WPKH)**:
  - 주소가 `3`으로 시작 (예: `3J98t1...`).
  - 블록 크기를 줄이고 트랜잭션 효율성을 높임.

- **Native SegWit (Bech32)**:
  - 주소가 `bc1`로 시작 (예: `bc1qw...`).
  - 트랜잭션 크기를 가장 효율적으로 만듦.

---

## 4. 하나의 마스터 키로 여러 주소 관리

### 마스터 키가 여러 지갑을 관리하는 원리
- 비트코인은 **BIP-32** (계층적 결정적 지갑) 표준을 사용
- 마스터 개인키는 **파생 경로(Derivation Path)** 를 통해 여러 자식키를 생성:
  - 예: `m/44'/0'/0'/0/0`
    - `44'`: BIP-44 다중 자산 HD 지갑.
    - `0'`: 비트코인 메인넷.
    - `0'/0`: 외부 지갑 (입금용).

- 생성된 키와 주소는 결정적으로 저장되며, 동일한 마스터 키로 항상 동일한 주소를 재생성 가능

---

## 5. 트랜잭션 효율성과 보안을 높이는 표준

### SegWit과 BIP-148의 중요성

1. **SegWit (Segregated Witness)**:
   - **BIP-141**에서 도입.
   - 서명 데이터를 트랜잭션 블록 외부로 분리하여 블록 크기를 증가시키고 수수료를 줄임.
   - 트랜잭션 식별자(Transaction ID) 변경 문제를 해결하여 트랜잭션 무결성을 강화.

2. **BIP-148 (사용자 활성화 소프트 포크)**:
   - SegWit을 지원하는 블록만 허용하도록 노드에서 설정.
   - 네트워크 전반에 SegWit 적용을 강제하여 효율성과 보안을 강화.

---

## 6. 단계별 과정: 시드에서 주소까지

### 1. 시드 문구 입력
- 사용자가 시드 문구를 생성하거나 입력.
- 선택적으로 패스프레이즈를 추가해 보안을 강화.

### 2. 마스터 개인키 생성
- PBKDF2(HMAC-SHA512)를 사용해 마스터 개인키를 생성.

### 3. 자식 개인키/공개키 생성
- BIP-32 경로를 사용해 자식 키를 생성.

### 4. 주소 생성
- 공개키를 해싱(SHA-256 → RIPEMD-160)하여 주소 생성.
- 생성된 주소는 Legacy, SegWit 등 다양한 형식으로 표현 가능.

---

## 7. Python 코드 예제: 비트코인 주소 생성

```python
from bip_utils import Bip39SeedGenerator, Bip32Slip10Secp256k1, Bip44

# 1. 시드 문구로부터 시드 생성
mnemonic = "abandon abandon abandon abandon abandon abandon abandon abandon abandon abandon abandon about"
seed = Bip39SeedGenerator(mnemonic).Generate()

# 2. 마스터 개인키 생성
bip32_ctx = Bip32Slip10Secp256k1.FromSeed(seed)

# 3. 파생 경로(BIP-44)로 주소 생성
bip44_ctx = Bip44.FromBip32(bip32_ctx, coin_type=0)  # 비트코인 메인넷
address = bip44_ctx.Purpose().Coin().Account(0).Change(0).AddressIndex(0).PublicKey().ToAddress()

print(f"생성된 주소: {address}")
```


## 8. 추가적인 궁금증

### 8.1 BIP 종류와 목적, 그리고 거래소에서의 활용

비트코인 개선 제안(Bitcoin Improvement Proposals, BIPs)은 비트코인의 기능, 표준, 그리고 사용성을 개선하기 위한 제안.

각 BIP는 특정 문제를 해결하거나 기능을 추가하기 위해 도입되었으며, 거래소는 고객 자산 관리와 트랜잭션 최적화를 위해 다양한 BIP를 활용

---

#### 1. 주요 BIP와 목적

**1.1 BIP-39: Mnemonic Seed**
- **목적**: 사람이 읽기 쉬운 시드 문구를 통해 개인키를 생성.
- **내용**:
  - 12, 15, 18, 21, 24개의 단어로 구성된 시드 문구를 사용.
  - 백업과 복구가 용이.
- **거래소 활용**:
  - 고객 입금 주소를 생성하는 HD 지갑에서 시드 문구를 통해 지갑 마스터 키를 관리.

---

**1.2 BIP-32: Hierarchical Deterministic Wallets (HD 지갑)**
- **목적**: 하나의 마스터 키로 여러 지갑 주소를 생성하고 관리.
- **내용**:
  - 계층적으로 키를 파생시켜 여러 지갑을 관리.
  - 동일한 마스터 키로 항상 동일한 파생 키를 생성.
  - 파생 경로 예: `m/44'/0'/0'/0/0`.
- **거래소 활용**:
  - 고객별 입금 주소를 생성하여 효율적으로 자산을 관리.
  - 하나의 마스터 키로 수백만 개의 입금 주소를 생성 가능.

---

**1.3 BIP-44: Multi-Asset HD Wallet**
- **목적**: 다양한 암호화폐를 하나의 HD 지갑에서 관리.
- **내용**:
  - 코인 유형에 따라 파생 경로를 표준화.
  - 예: `m/44'/60'/0'/0/0` (이더리움), `m/44'/0'/0'/0/0` (비트코인).
- **거래소 활용**:
  - 여러 블록체인을 지원하는 거래소에서 HD 지갑의 다중 자산 관리에 사용.

---

**1.4 BIP-141: Segregated Witness (SegWit)**
- **목적**: 트랜잭션 효율성 향상 및 수수료 절감.
- **내용**:
  - 서명 데이터를 트랜잭션에서 분리하여 블록 크기를 효과적으로 증가.
  - 트랜잭션 ID 변경 문제(트랜잭션 가변성) 해결.
- **거래소 활용**:
  - SegWit 주소(P2SH 또는 Bech32)를 통해 트랜잭션 비용 절감.
  - 트랜잭션 처리량을 늘려 고객 요청에 빠르게 대응.

---

**1.5 BIP-148: User-Activated Soft Fork (UASF)**
- **목적**: SegWit 채택을 강제.
- **내용**:
  - SegWit 신호를 보내는 블록만 허용하여 네트워크 합의를 강제.
- **거래소 활용**:
  - SegWit 활성화를 통해 트랜잭션 처리 효율성 확보.

---

**1.6 BIP-173: Bech32 Address Format**
- **목적**: 더 간결하고 효율적인 주소 포맷.
- **내용**:
  - SegWit 트랜잭션을 지원하는 새로운 주소 형식(`bc1`로 시작).
  - Base32 형식으로 오류 탐지 기능 제공.
- **거래소 활용**:
  - 고객에게 Bech32 주소를 제공하여 수수료를 낮추고 트랜잭션 속도를 향상.

---

**1.7 BIP-125: Replace-by-Fee (RBF)**
- **목적**: 미확인 트랜잭션의 수수료를 증가시켜 우선순위를 조정.
- **내용**:
  - 동일한 트랜잭션의 수수료를 높여 새롭게 브로드캐스트 가능.
- **거래소 활용**:
  - 고객이 급한 출금을 요청할 때 RBF로 트랜잭션 우선순위를 조정.

---

#### 2. 거래소에서의 BIP 활용 사례

**2.1 고객 입금 처리**
- **사용 BIP**: BIP-39, BIP-32, BIP-44
- **설명**:
  - 각 고객에게 HD 지갑 기반으로 고유한 입금 주소를 생성.
  - 동일한 마스터 키로 모든 고객 주소를 효율적으로 관리.

**2.2 트랜잭션 처리 효율화**
- **사용 BIP**: BIP-141, BIP-148, BIP-173
- **설명**:
  - SegWit 주소를 통해 트랜잭션 수수료를 절감.
  - Bech32 주소로 효율성과 보안을 강화.

**2.3 긴급 출금 요청**
- **사용 BIP**: BIP-125
- **설명**:
  - Replace-by-Fee를 통해 미확인 트랜잭션을 빠르게 처리.

**2.4 멀티 자산 관리**
- **사용 BIP**: BIP-44
- **설명**:
  - 비트코인, 이더리움 등 다양한 블록체인을 지원하는 멀티 자산 관리.

---
